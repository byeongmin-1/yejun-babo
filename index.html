<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timer App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid black; padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>Timer App</h1>

  <div>
    <input id="timerName" placeholder="Timer name"/>
    <input id="hours" type="number" min="0" placeholder="Hours"/>
    <input id="minutes" type="number" min="0" max="59" placeholder="Minutes"/>
    <input id="seconds" type="number" min="0" max="59" placeholder="Seconds"/>
    <button onclick="addTimer()">Add Timer</button>
    <button onclick="resetAll()">Reset All</button>
  </div>

  <h2>Active Timers</h2>
  <table id="timersTable">
    <tr><th>Name</th><th>Time Left</th></tr>
  </table>

  <h2>Finished Timers</h2>
  <table id="finishedTable">
    <tr><th>Name</th><th>Started</th><th>Finished</th></tr>
  </table>

  <script>
    let timers = JSON.parse(localStorage.getItem("timers")) || [];
    let finishedTimers = JSON.parse(localStorage.getItem("finishedTimers")) || [];

    function saveData() {
      localStorage.setItem("timers", JSON.stringify(timers));
      localStorage.setItem("finishedTimers", JSON.stringify(finishedTimers));
    }

    function renderTimers() {
      const timersTable = document.getElementById("timersTable");
      const finishedTable = document.getElementById("finishedTable");

      timersTable.innerHTML = "<tr><th>Name</th><th>Time Left</th></tr>";
      finishedTable.innerHTML = "<tr><th>Name</th><th>Started</th><th>Finished</th></tr>";

      timers.forEach((t, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${t.name}</td>
                         <td>${t.hours}h ${t.minutes}m ${t.seconds}s</td>`;
        timersTable.appendChild(row);
      });

      finishedTimers.forEach((t, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${t.name}</td>
                         <td>${t.startTime}</td>
                         <td>${t.endTime}</td>`;
        finishedTable.appendChild(row);
      });
    }

    function addTimer() {
      const name = document.getElementById("timerName").value || "Unnamed";
      const hours = parseInt(document.getElementById("hours").value) || 0;
      const minutes = parseInt(document.getElementById("minutes").value) || 0;
      const seconds = parseInt(document.getElementById("seconds").value) || 0;

      timers.push({ 
        name, 
        hours, 
        minutes, 
        seconds, 
        startTime: new Date().toLocaleString() 
      });
      saveData();
      renderTimers();
    }

    function resetAll() {
      let message = `ðŸ”„ Reset pressed at: ${new Date().toLocaleString()}\n\n`;

      message += "Active Timers:\n";
      if (timers.length === 0) {
        message += "None\n";
      } else {
        timers.forEach(t => {
          message += `${t.name} | ${t.hours}h ${t.minutes}m ${t.seconds}s\n`;
        });
      }

      message += "\nFinished Timers:\n";
      if (finishedTimers.length === 0) {
        message += "None\n";
      } else {
        finishedTimers.forEach(t => {
          message += `${t.name} | Started: ${t.startTime} | Finished: ${t.endTime}\n`;
        });
      }

      let formData = new FormData();
      formData.append("email", "byeongminchoi12@gmail.com");
      formData.append("message", message);

      fetch("https://formspree.io/f/mqadbkbd", {
        method: "POST",
        body: formData,
        headers: { 'Accept': 'application/json' }
      })
      .then(response => {
        if (response.ok) {
          alert("âœ… Reset info sent to Formspree!");
        } else {
          alert("âš ï¸ Failed to send reset info.");
        }
      })
      .catch(() => alert("âš ï¸ Error sending reset info."));

      // Clear data
      localStorage.removeItem("timers");
      localStorage.removeItem("finishedTimers");
      timers = [];
      finishedTimers = [];
      renderTimers();
    }

    // Example countdown (runs every second)
    setInterval(() => {
      timers.forEach((t, i) => {
        if (t.seconds > 0) {
          t.seconds--;
        } else if (t.minutes > 0) {
          t.minutes--; t.seconds = 59;
        } else if (t.hours > 0) {
          t.hours--; t.minutes = 59; t.seconds = 59;
        } else {
          // Timer finished
          finishedTimers.push({
            name: t.name,
            startTime: t.startTime,
            endTime: new Date().toLocaleString()
          });
          timers.splice(i, 1);
        }
      });
      saveData();
      renderTimers();
    }, 1000);

    renderTimers();
  </script>
</body>
</html>
